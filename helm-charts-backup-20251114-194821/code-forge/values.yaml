replicaCount: 2

image:
  repository: neural-hive-mind/code-forge
  tag: "1.0.0"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  ports:
    http: 8080
    grpc: 50051
    metrics: 9090

resources:
  requests:
    cpu: 1000m
    memory: 2Gi
  limits:
    cpu: 2000m
    memory: 4Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

podDisruptionBudget:
  minAvailable: 1

serviceAccount:
  create: true
  name: code-forge

serviceMonitor:
  enabled: true

config:
  SERVICE_NAME: code-forge
  NAMESPACE: neural-hive-execution
  CLUSTER: production

  # Kafka
  KAFKA_BOOTSTRAP_SERVERS: kafka:9092
  KAFKA_TICKETS_TOPIC: execution.tickets
  KAFKA_RESULTS_TOPIC: code-forge.results
  KAFKA_CONSUMER_GROUP_ID: code-forge

  # PostgreSQL
  POSTGRES_HOST: postgres
  POSTGRES_PORT: 5432
  POSTGRES_DB: code_forge

  # MongoDB
  MONGODB_HOST: mongodb
  MONGODB_PORT: 27017
  MONGODB_DB: code_forge

  # Redis
  REDIS_HOST: redis
  REDIS_PORT: 6379

  # Service Registry
  SERVICE_REGISTRY_HOST: service-registry
  SERVICE_REGISTRY_PORT: 50051

  # Execution Ticket Service
  EXECUTION_TICKET_SERVICE_URL: http://execution-ticket-service:8080

  # Templates
  TEMPLATES_GIT_REPO: https://github.com/neural-hive/templates.git
  TEMPLATES_GIT_BRANCH: main
  TEMPLATES_LOCAL_PATH: /app/templates

  # Pipeline
  MAX_CONCURRENT_PIPELINES: 3
  PIPELINE_TIMEOUT_SECONDS: 3600
  AUTO_APPROVAL_THRESHOLD: 0.9
  MIN_QUALITY_SCORE: 0.5
  MIN_TEST_COVERAGE: 0.8

  # Observability
  OTEL_EXPORTER_ENDPOINT: http://otel-collector:4317
  LOG_LEVEL: INFO
  LOG_FORMAT: json

secrets:
  # PostgreSQL
  postgresUser: "code_forge"
  postgresPassword: "change-in-production"

  # MongoDB
  mongodbUri: "mongodb://code_forge:change-in-production@mongodb:27017/code_forge"

  # Redis
  redisPassword: ""

  # Kafka SASL (se habilitado)
  kafkaSaslUsername: ""
  kafkaSaslPassword: ""

  # Git credentials (se reposit√≥rio privado)
  gitUsername: ""
  gitToken: ""

networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: istio-system
        - namespaceSelector:
            matchLabels:
              name: monitoring
        - podSelector:
            matchLabels:
              neural-hive-mind.org/code-forge-access: "enabled"
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: kafka
      ports:
        - protocol: TCP
          port: 9092
    - to:
        - namespaceSelector:
            matchLabels:
              name: postgres
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - namespaceSelector:
            matchLabels:
              name: mongodb
      ports:
        - protocol: TCP
          port: 27017
    - to:
        - namespaceSelector:
            matchLabels:
              name: redis
      ports:
        - protocol: TCP
          port: 6379
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: service-registry
      ports:
        - protocol: TCP
          port: 50051
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: execution-ticket-service
      ports:
        - protocol: TCP
          port: 8080
    - to: []  # DNS
      ports:
        - protocol: UDP
          port: 53
    - to: []  # HTTPS para Git
      ports:
        - protocol: TCP
          port: 443
