# Valores padrão para OPA Gatekeeper - Neural Hive-Mind
# Configuração para policy-as-code com governança dinâmica

gatekeeper:
  # Configurações de replicação para alta disponibilidade
  replicas: 3

  # Configurações de recursos
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  # Configurações de audit
  audit:
    replicas: 2
    logLevel: INFO
    # Intervalo de auditoria em segundos
    auditInterval: 60
    # Limite de violações por enforcement
    constraintViolationLimit: 20
    # Chunk size para audit
    auditChunkSize: 50
    # Configurações de recursos para audit
    resources:
      limits:
        cpu: 500m
        memory: 768Mi
      requests:
        cpu: 200m
        memory: 256Mi

  # Configurações de validating webhook
  validatingWebhook:
    # Timeout em segundos
    timeoutSeconds: 10
    # Failure policy (Ignore ou Fail)
    failurePolicy: Fail
    # Namespaces excluídos da validação
    namespaceSelector:
      matchExpressions:
        - key: neuralhive.ai/policy-enforcement
          operator: NotIn
          values: ["disabled"]
        - key: name
          operator: NotIn
          values: ["kube-system", "kube-public", "kube-node-lease", "gatekeeper-system"]

  # Configurações de webhook
  webhook:
    replicas: 3
    logLevel: INFO
    # Porta do webhook
    port: 8443
    # Certificados TLS
    certDir: /certs
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 200m
        memory: 256Mi

  # Configurações de controller manager
  controllerManager:
    # Porta de métricas
    metricsPort: 8888
    # Porta de health
    healthPort: 8090
    # Porta de readiness
    readinessPort: 8091
    # Log level
    logLevel: INFO
    # Modo de enforcement
    exemptNamespacesFromWebhook:
      - kube-system
      - kube-public
      - kube-node-lease
      - gatekeeper-system

  # Pod Disruption Budget
  podDisruptionBudget:
    minAvailable: 1

  # Configurações de segurança
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 1000

  # Configurações de node affinity
  nodeSelector:
    kubernetes.io/os: linux

  # Tolerations para nodes dedicados
  tolerations: []

  # Affinity para distribuição em zonas
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: gatekeeper.sh/operation
                  operator: In
                  values: ["webhook", "audit"]
            topologyKey: topology.kubernetes.io/zone

  # Configurações de monitoramento
  prometheus:
    enabled: true
    port: 8888

  # Configurações de mutation (preview)
  mutatingWebhook:
    enabled: false

  # Configurações de expansão de template
  expansionTemplates:
    enabled: true

  # Configurações de geração de políticas externas
  externalDataProviderResponseCacheTTL: 10m

  # Configurações de TLS
  tls:
    # Renovação automática de certificados
    caRotateInterval: 8760h # 1 ano
    certRotateInterval: 720h # 30 dias

# Configurações customizadas do Neural Hive-Mind
neuralhive:
  # Namespaces onde as políticas serão aplicadas
  enforcedNamespaces:
    - neural-hive-cognition
    - neural-hive-orchestration
    - neural-hive-execution
    - neural-hive-observability

  # Modo de enforcement inicial
  # warn: apenas registra violações
  # enforce: bloqueia violações
  enforcementMode: warn

  # Transição automática para enforce após período de validação
  autoEnforce:
    enabled: true
    afterDays: 7

  # Métricas e alertas
  monitoring:
    enabled: true
    dashboards:
      enabled: true
    alerts:
      enabled: true
      violationThreshold: 10

  # Políticas padrão habilitadas
  defaultPolicies:
    - mtls-required
    - image-signature-required
    - resource-limits-required
    - network-policies-required
    - pod-security-standards

  # Configurações de auditoria e compliance
  compliance:
    # Relatórios de compliance
    reportingEnabled: true
    reportingInterval: 24h
    # Retenção de logs de violação
    violationLogRetention: 30d