apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "consensus-engine.configMapName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "consensus-engine.labels" . | nindent 4 }}
data:
  ENVIRONMENT: {{ .Values.config.environment | quote }}
  LOG_LEVEL: {{ .Values.config.logLevel | quote }}

  # Kafka Configuration
  KAFKA_BOOTSTRAP_SERVERS: {{ .Values.config.kafka.bootstrapServers | quote }}
  KAFKA_CONSUMER_GROUP_ID: {{ .Values.config.kafka.consumerGroupId | quote }}
  KAFKA_PLANS_TOPIC_CONSUME: {{ .Values.config.kafka.plansTopicConsume | quote }}
  KAFKA_CONSENSUS_TOPIC_PRODUCE: {{ .Values.config.kafka.consensusTopicProduce | quote }}
  KAFKA_SECURITY_PROTOCOL: {{ .Values.config.kafka.securityProtocol | quote }}
  KAFKA_SASL_MECHANISM: {{ .Values.config.kafka.saslMechanism | quote }}

  # Specialist Configuration
  SPECIALIST_BUSINESS_ENDPOINT: {{ .Values.config.specialists.businessEndpoint | quote }}
  SPECIALIST_TECHNICAL_ENDPOINT: {{ .Values.config.specialists.technicalEndpoint | quote }}
  SPECIALIST_BEHAVIOR_ENDPOINT: {{ .Values.config.specialists.behaviorEndpoint | quote }}
  SPECIALIST_EVOLUTION_ENDPOINT: {{ .Values.config.specialists.evolutionEndpoint | quote }}
  SPECIALIST_ARCHITECTURE_ENDPOINT: {{ .Values.config.specialists.architectureEndpoint | quote }}
  SPECIALIST_GRPC_TIMEOUT_MS: {{ .Values.config.specialists.grpcTimeoutMs | quote }}
  SPECIALIST_GRPC_MAX_RETRIES: {{ .Values.config.specialists.grpcMaxRetries | quote }}

  # MongoDB Configuration
  MONGODB_URI: {{ .Values.config.mongodb.uri | quote }}
  MONGODB_DATABASE: {{ .Values.config.mongodb.database | quote }}
  MONGODB_CONSENSUS_COLLECTION: {{ .Values.config.mongodb.consensusCollection | quote }}

  # Redis Configuration
  REDIS_CLUSTER_NODES: {{ .Values.config.redis.clusterNodes | quote }}
  REDIS_SSL_ENABLED: {{ .Values.config.redis.sslEnabled | quote }}
  REDIS_PHEROMONE_TTL: {{ .Values.config.redis.pheromoneTtl | quote }}
  REDIS_PHEROMONE_DECAY_RATE: {{ .Values.config.redis.pheromoneDecayRate | quote }}

  # OpenTelemetry Configuration
  OTEL_ENDPOINT: {{ .Values.config.openTelemetry.endpoint | quote }}
  OTEL_SAMPLING_RATE: {{ .Values.config.openTelemetry.samplingRate | quote }}

  # Consensus Configuration
  CONSENSUS_MIN_CONFIDENCE_SCORE: {{ .Values.config.consensus.minConfidenceScore | quote }}
  CONSENSUS_MAX_DIVERGENCE_THRESHOLD: {{ .Values.config.consensus.maxDivergenceThreshold | quote }}
  CONSENSUS_HIGH_RISK_THRESHOLD: {{ .Values.config.consensus.highRiskThreshold | quote }}
  CONSENSUS_CRITICAL_RISK_THRESHOLD: {{ .Values.config.consensus.criticalRiskThreshold | quote }}
  CONSENSUS_BAYESIAN_PRIOR_WEIGHT: {{ .Values.config.consensus.bayesianPriorWeight | quote }}
  CONSENSUS_VOTING_WEIGHT_DECAY: {{ .Values.config.consensus.votingWeightDecay | quote }}
  CONSENSUS_REQUIRE_UNANIMOUS_FOR_CRITICAL: {{ .Values.config.consensus.requireUnanimousForCritical | quote }}
  CONSENSUS_FALLBACK_TO_DETERMINISTIC: {{ .Values.config.consensus.fallbackToDeterministic | quote }}

  # Feature Flags
  ENABLE_BAYESIAN_AVERAGING: {{ .Values.config.features.enableBayesianAveraging | quote }}
  ENABLE_PHEROMONES: {{ .Values.config.features.enablePheromones | quote }}
  ENABLE_FALLBACK: {{ .Values.config.features.enableFallback | quote }}
  ENABLE_PARALLEL_INVOCATION: {{ .Values.config.features.enableParallelInvocation | quote }}
