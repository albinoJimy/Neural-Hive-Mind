apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "neural-hive-grafana.fullname" . }}-dashboard-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neural-hive-grafana.labels" . | nindent 4 }}
    grafana_dashboard: "1"
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
    # Neural Hive-Mind Overview
    - name: 'neural-hive-overview'
      orgId: 1
      folder: 'Neural Hive-Mind'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/neural-hive-overview

    # Fluxos Operacionais
    - name: 'fluxos-operacionais'
      orgId: 1
      folder: 'Fluxos Operacionais'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/fluxos

    # SLOs e Error Budgets
    - name: 'slos-error-budgets'
      orgId: 1
      folder: 'SLOs & Error Budgets'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/slos

    # Infrastructure
    - name: 'infrastructure'
      orgId: 1
      folder: 'Infrastructure'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/infrastructure

    # Observability Stack
    - name: 'observability-stack'
      orgId: 1
      folder: 'Observability'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/observability

    # Governance & Approval
    - name: 'governance'
      orgId: 1
      folder: 'Governance'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      updateIntervalSeconds: 10
      options:
        path: /var/lib/grafana/dashboards/governance

---
# ConfigMap para folders customizadas
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "neural-hive-grafana.fullname" . }}-folders
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neural-hive-grafana.labels" . | nindent 4 }}
data:
  folders.json: |
    [
      {
        "id": 1,
        "uid": "neural-hive-main",
        "title": "Neural Hive-Mind",
        "tags": ["neural-hive", "overview"],
        "timezone": "browser",
        "refresh": "30s",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Viewer",
            "permission": 1
          },
          {
            "role": "Editor",
            "permission": 2
          }
        ]
      },
      {
        "id": 2,
        "uid": "fluxos-operacionais",
        "title": "Fluxos Operacionais",
        "tags": ["fluxos", "operations"],
        "timezone": "browser",
        "refresh": "15s",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Viewer",
            "permission": 1
          },
          {
            "role": "Editor",
            "permission": 2
          }
        ]
      },
      {
        "id": 3,
        "uid": "slos-error-budgets",
        "title": "SLOs & Error Budgets",
        "tags": ["slo", "sli", "error-budget"],
        "timezone": "browser",
        "refresh": "1m",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Viewer",
            "permission": 1
          },
          {
            "role": "Editor",
            "permission": 2
          }
        ]
      },
      {
        "id": 4,
        "uid": "infrastructure",
        "title": "Infrastructure",
        "tags": ["kubernetes", "infrastructure", "istio"],
        "timezone": "browser",
        "refresh": "30s",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Viewer",
            "permission": 1
          },
          {
            "role": "Editor",
            "permission": 2
          }
        ]
      },
      {
        "id": 5,
        "uid": "observability-stack",
        "title": "Observability",
        "tags": ["observability", "monitoring", "telemetry"],
        "timezone": "browser",
        "refresh": "1m",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Admin",
            "permission": 4
          }
        ]
      },
      {
        "id": 6,
        "uid": "governance",
        "title": "Governance",
        "tags": ["governance", "approval", "risk", "compliance"],
        "timezone": "browser",
        "refresh": "30s",
        "schemaVersion": 39,
        "permissions": [
          {
            "role": "Viewer",
            "permission": 1
          },
          {
            "role": "Editor",
            "permission": 2
          }
        ]
      }
    ]

---
# ConfigMap para variÃ¡veis globais de dashboards
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "neural-hive-grafana.fullname" . }}-dashboard-variables
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neural-hive-grafana.labels" . | nindent 4 }}
data:
  variables.json: |
    {
      "templating": {
        "list": [
          {
            "name": "environment",
            "type": "constant",
            "current": {
              "value": "{{ .Values.global.environment }}",
              "text": "{{ .Values.global.environment }}"
            },
            "hide": 0,
            "description": "Environment (production, staging, development)"
          },
          {
            "name": "cluster",
            "type": "constant",
            "current": {
              "value": "{{ .Values.global.cluster | default "neural-hive-main" }}",
              "text": "{{ .Values.global.cluster | default "neural-hive-main" }}"
            },
            "hide": 0,
            "description": "Kubernetes cluster name"
          },
          {
            "name": "namespace",
            "type": "query",
            "query": "label_values(kube_namespace_info, namespace)",
            "datasource": "Prometheus",
            "refresh": 1,
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "current": {
              "value": ["neural-hive", "gateway", "observability"],
              "text": ["neural-hive", "gateway", "observability"]
            }
          },
          {
            "name": "neural_hive_component",
            "type": "query",
            "query": "label_values({__name__=~\"neural_hive_.*\"}, neural_hive_component)",
            "datasource": "Prometheus",
            "refresh": 2,
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "current": {
              "value": "all",
              "text": "All"
            }
          },
          {
            "name": "neural_hive_layer",
            "type": "query",
            "query": "label_values({__name__=~\"neural_hive_.*\"}, neural_hive_layer)",
            "datasource": "Prometheus",
            "refresh": 2,
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "current": {
              "value": "all",
              "text": "All"
            }
          },
          {
            "name": "service",
            "type": "query",
            "query": "label_values({__name__=~\"neural_hive_.*\"}, service_name)",
            "datasource": "Prometheus",
            "refresh": 2,
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "current": {
              "value": "all",
              "text": "All"
            }
          },
          {
            "name": "intent_id",
            "type": "query",
            "query": "label_values({__name__=~\"neural_hive_.*\"}, neural_hive_intent_id)",
            "datasource": "Prometheus",
            "refresh": 2,
            "sort": 1,
            "multi": false,
            "includeAll": false,
            "current": {
              "value": "",
              "text": "Select Intent ID"
            }
          },
          {
            "name": "plan_id",
            "type": "query",
            "query": "label_values({__name__=~\"neural_hive_.*\"}, neural_hive_plan_id)",
            "datasource": "Prometheus",
            "refresh": 2,
            "sort": 1,
            "multi": false,
            "includeAll": false,
            "current": {
              "value": "",
              "text": "Select Plan ID"
            }
          },
          {
            "name": "time_range",
            "type": "interval",
            "auto": true,
            "auto_count": 30,
            "auto_min": "10s",
            "current": {
              "value": "5m",
              "text": "5m"
            },
            "options": [
              { "value": "30s", "text": "30s" },
              { "value": "1m", "text": "1m" },
              { "value": "5m", "text": "5m" },
              { "value": "15m", "text": "15m" },
              { "value": "30m", "text": "30m" },
              { "value": "1h", "text": "1h" }
            ]
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "refresh": "30s",
      "annotations": {
        "list": [
          {
            "name": "Deployments",
            "datasource": "Prometheus",
            "enable": true,
            "expr": "increase(deployment_generation{namespace=~\"$namespace\"}[5m]) > 0",
            "iconColor": "green",
            "tags": ["deployment"],
            "textFormat": "Deployment: {{ "{{service}}" }}",
            "titleFormat": "Deployment"
          },
          {
            "name": "Alerts",
            "datasource": "Prometheus",
            "enable": true,
            "expr": "ALERTS{alertstate=\"firing\", namespace=~\"$namespace\"}",
            "iconColor": "red",
            "tags": ["alert"],
            "textFormat": "Alert: {{ "{{alertname}}" }} - {{ "{{summary}}" }}",
            "titleFormat": "Alert Firing"
          }
        ]
      }
    }

---
# ConfigMap para temas customizados
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "neural-hive-grafana.fullname" . }}-themes
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neural-hive-grafana.labels" . | nindent 4 }}
data:
  neural-hive-theme.json: |
    {
      "name": "Neural Hive-Mind Dark",
      "colors": {
        "primary": "#00D9FF",
        "secondary": "#FF6B6B",
        "success": "#51CF66",
        "warning": "#FFD93D",
        "error": "#FF6B6B",
        "background": "#1A1D23",
        "surface": "#25262B",
        "text": "#C1C2C5"
      },
      "typography": {
        "fontFamily": "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"
      },
      "spacing": {
        "xs": 4,
        "sm": 8,
        "md": 16,
        "lg": 24,
        "xl": 32
      }
    }