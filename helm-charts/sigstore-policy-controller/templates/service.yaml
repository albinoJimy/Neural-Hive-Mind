{{- $ctx := include "sigstore-policy-controller.context" . | fromYaml }}

{{/*
Sobrescrever fullname para usar o nome do webhook + "-service" conforme padr√£o original
*/}}
{{- $modifiedCtx := deepCopy $ctx }}
{{- $_ := set $modifiedCtx "fullname" (printf "%s-service" .Values.webhook.name) }}

{{/*
Construir valores modificados para remover porta de metrics se monitoring desabilitado
*/}}
{{- $modifiedValues := deepCopy .Values }}
{{- if not .Values.monitoring.enabled }}
{{- $httpsWebhookPort := index .Values.service.ports "https-webhook" }}
{{- $ports := dict "https-webhook" $httpsWebhookPort }}
{{- $_ := set $modifiedValues.service "ports" $ports }}
{{- end }}

{{- include "neural-hive.service" (dict "values" $modifiedValues "context" $modifiedCtx) }}
