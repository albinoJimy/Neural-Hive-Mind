{{- if .Values.policies.requireSignatures }}
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: neural-hive-signed-images-policy
  labels:
    {{- include "sigstore-policy-controller.labels" . | nindent 4 }}
spec:
  images:
  {{- range .Values.policies.allowedRegistries }}
  - glob: {{ . | quote }}
  {{- end }}
  authorities:
  - keyless:
      url: {{ .Values.cosign.fulcioURL | default "https://fulcio.sigstore.dev" }}
      identities:
      {{- range .Values.policies.allowedSubjects }}
      - issuer: {{ index $.Values.policies.allowedIssuers 0 | default "https://token.actions.githubusercontent.com" }}
        subject: {{ . | quote }}
      {{- end }}
    ctlog:
      url: {{ .Values.cosign.rekorURL | default "https://rekor.sigstore.dev" }}
{{- end }}