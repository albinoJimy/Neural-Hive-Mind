# Metadados para templates comuns
component: "policy-controller"
layer: "security"

# Configurações da imagem
image:
  repository: gcr.io/projectsigstore/policy-controller
  tag: v0.7.1
  pullPolicy: IfNotPresent

# Webhook configuration
webhook:
  name: policy-controller-webhook
  namespace: cosign-system
  port: 8443
  failurePolicy: Fail

# Service account
serviceAccount:
  create: true
  name: policy-controller
  annotations:
    eks.amazonaws.com/role-arn: ""

# Recursos
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Replicas e disponibilidade
replicaCount: 2

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Deployment strategy
deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Estrutura compatível com neural-hive.service
service:
  type: ClusterIP
  annotations: {}
  ports:
    https-webhook:
      port: 443
      targetPort: 8443
      protocol: TCP
    metrics:
      port: 9090
      targetPort: 9090
      protocol: TCP

# NodeSelector e afinidade
nodeSelector: {}
tolerations: []
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - sigstore-policy-controller
        topologyKey: kubernetes.io/hostname

# Configurações de logging
logging:
  level: info
  format: json

# Configurações TLS
tls:
  secretName: policy-controller-webhook-certs
  caCert: ""

# Configurações Cosign
cosign:
  cosignRoot: ""
  rekorURL: https://rekor.sigstore.dev
  fulcioURL: https://fulcio.sigstore.dev
  ctlogPublicKeySecret: ""

# Configurações específicas do cluster
cluster:
  name: ""
  region: us-east-1

# Políticas padrão
policies:
  requireSignatures: true
  allowedRegistries:
    - "*.amazonaws.com/*"
    - "public.ecr.aws/*"
    - "docker.io/library/*"
    - "gcr.io/distroless/*"
    - "registry.k8s.io/*"
  allowedSubjects:
    - "https://github.com/*"
    - "https://token.actions.githubusercontent.com"
  allowedIssuers:
    - "https://token.actions.githubusercontent.com"
    - "https://oauth2.sigstore.dev/auth"

# Istio integration
istio:
  enabled: false
  mtls:
    mode: STRICT

# Observability
observability:
  prometheus:
    enabled: true

# Configurações de monitoramento
monitoring:
  enabled: true
  serviceMonitor:
    enabled: false
  metrics:
    port: 9090
    path: /metrics

# Configurações de rede
networkPolicy:
  enabled: false

# PodSecurityPolicy/PodSecurityStandards
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsGroup: 65534
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534

podAnnotations: {}

podLabels:
  neural-hive.io/domain: image-verification

# Probes
livenessProbe:
  httpGet:
    path: /healthz
    port: https-webhook
    scheme: HTTPS
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /readyz
    port: https-webhook
    scheme: HTTPS
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 5
  failureThreshold: 3
