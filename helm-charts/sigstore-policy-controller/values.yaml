# Configuração padrão do Sigstore Policy Controller

# Configurações da imagem
image:
  repository: gcr.io/projectsigstore/policy-controller
  tag: v0.7.1
  pullPolicy: IfNotPresent

# Webhook configuration
webhook:
  name: policy-controller-webhook
  namespace: cosign-system
  port: 8443
  failurePolicy: Fail

# Service account
serviceAccount:
  create: true
  name: policy-controller
  annotations:
    # IRSA annotation para workload identity
    eks.amazonaws.com/role-arn: ""

# Recursos
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Replicas e disponibilidade
replicaCount: 2

# NodeSelector e afinidade
nodeSelector: {}
tolerations: []
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - sigstore-policy-controller
        topologyKey: kubernetes.io/hostname

# Configurações de logging
logging:
  level: info
  format: json

# Configurações TLS
tls:
  secretName: policy-controller-webhook-certs
  caCert: ""

# Configurações Cosign
cosign:
  # Cosign root configuration
  cosignRoot: ""
  # Rekor URL
  rekorURL: https://rekor.sigstore.dev
  # Fulcio URL
  fulcioURL: https://fulcio.sigstore.dev
  # CTLOG public key
  ctlogPublicKeySecret: ""

# Configurações específicas do cluster
cluster:
  name: ""
  region: us-east-1

# Políticas padrão
policies:
  # Require signatures for all images by default
  requireSignatures: true

  # Allowed registries for signed images
  allowedRegistries:
    - "*.amazonaws.com/*"  # ECR registries
    - "public.ecr.aws/*"   # Public ECR
    - "docker.io/library/*" # Official Docker images
    - "gcr.io/distroless/*" # Distroless images
    - "registry.k8s.io/*"  # Kubernetes images

  # Subjects that can sign images (OIDC identities)
  allowedSubjects:
    - "https://github.com/*"
    - "https://token.actions.githubusercontent.com"

  # Issuers that can sign images
  allowedIssuers:
    - "https://token.actions.githubusercontent.com"
    - "https://oauth2.sigstore.dev/auth"

# Configurações de monitoramento
monitoring:
  enabled: true
  serviceMonitor:
    enabled: false
  metrics:
    port: 9090
    path: /metrics

# Configurações de rede
networkPolicy:
  enabled: false

# PodSecurityPolicy/PodSecurityStandards
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsGroup: 65534
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534