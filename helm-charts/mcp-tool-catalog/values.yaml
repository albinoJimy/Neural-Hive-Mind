component: "mcp-tool-catalog"
layer: "infrastructure"

replicaCount: 2

# Disable Kubernetes service links to prevent env var collisions with pydantic settings
enableServiceLinks: false

image:
  repository: 37.60.241.150:30500/mcp-tool-catalog
  pullPolicy: IfNotPresent
  tag: "1.2.1"

deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

service:
  type: ClusterIP
  annotations: {}
  ports:
    http:
      port: 8080
      targetPort: 8080
      protocol: TCP
    metrics:
      port: 9091
      targetPort: 9091
      protocol: TCP

resources:
  requests:
    cpu: 200m      # Tool registry
    memory: 384Mi
  limits:
    cpu: 800m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

kafka:
  bootstrapServers: neural-hive-kafka-kafka-bootstrap.kafka.svc.cluster.local:9092
  requestTopic: mcp.tool.selection.requests
  responseTopic: mcp.tool.selection.responses
  consumerGroupId: mcp-tool-catalog-group

mongodb:
  url: mongodb://root:local_dev_password@mongodb.mongodb-cluster.svc.cluster.local:27017
  database: mcp_tool_catalog
  toolsCollection: tools
  selectionsCollection: selections_history

redis:
  url: redis://neural-hive-cache.redis-cluster.svc.cluster.local:6379
  cacheTtl: 3600
  cacheEnabled: true

serviceRegistry:
  grpcHost: service-registry.neural-hive.svc.cluster.local
  grpcPort: 50051
  heartbeatInterval: 30

geneticAlgorithm:
  populationSize: 50
  maxGenerations: 100
  crossoverProb: 0.7
  mutationProb: 0.2
  tournamentSize: 3
  convergenceThreshold: 0.01
  timeout: 30

toolExecution:
  timeout: 300
  maxConcurrent: 10
  retryMaxAttempts: 3

# MCP Server Configuration (Arquitetura Híbrida)
# Mapeamento tool_id → MCP Server URL para roteamento híbrido
# Ferramentas com MCP Server configurado usam o servidor externo (prioridade 1)
# Ferramentas sem configuração usam adapters locais (CLI/REST/Container)
mcpServers:
  # Trivy - Vulnerability Scanner
  trivy-001: "http://trivy-mcp-server.neural-hive-mcp.svc.cluster.local:3000"
  # SonarQube - Code Quality
  sonarqube-001: "http://sonarqube-mcp-server.neural-hive-mcp.svc.cluster.local:3000"
  # GitHub Copilot - AI Code Generation
  github-copilot-001: "http://ai-codegen-mcp-server.neural-hive-mcp.svc.cluster.local:3000"
  # OpenAI Codex - AI Code Generation
  openai-codex-001: "http://ai-codegen-mcp-server.neural-hive-mcp.svc.cluster.local:3000"

mcpServerConfig:
  timeoutSeconds: 30
  maxRetries: 3
  circuitBreakerThreshold: 5
  circuitBreakerTimeoutSeconds: 60

# Connection Timeouts Configuration
# Configurable timeouts for all client connections
timeouts:
  mongodb:
    connectMs: 10000
    serverSelectionMs: 5000
  redis:
    connectSeconds: 10
    socketSeconds: 10
  kafka:
    requestMs: 30000
    sessionMs: 30000
  serviceRegistry:
    connectSeconds: 10

# Health Checks Configuration
startupProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 60  # 10 minutos total (60 * 10s)

livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

observability:
  otelEndpoint: http://otel-collector:4317
  logLevel: INFO
  logFormat: json
  prometheus:
    enabled: true

istio:
  enabled: true
  mtls:
    mode: STRICT

analystAgents:
  host: analyst-agents
  port: 9090

# ========================================
# Tool Endpoints Configuration
# Endpoints configuráveis para ferramentas REST_API
# ========================================
toolEndpoints:
  # ANALYSIS Tools
  sonarqube:
    url: "http://sonarqube.neural-hive-tools.svc.cluster.local:9000/api"
    enabled: true
  checkmarx:
    url: "https://checkmarx.example.com/api"
    enabled: false
  veracode:
    url: "https://analysiscenter.veracode.com/api"
    enabled: false
  fortify:
    url: "https://fortify.example.com/api"
    enabled: false
  # GENERATION Tools
  githubCopilot:
    url: "https://api.github.com/copilot"
    enabled: false
  springInitializr:
    url: "https://start.spring.io"
    enabled: true
  openaiCodex:
    url: "https://api.openai.com/v1"
    enabled: false
  # VALIDATION Tools
  burpSuite:
    url: "http://burpsuite.neural-hive-tools.svc.cluster.local:8080"
    enabled: false
  # AUTOMATION Tools
  githubActions:
    url: "https://api.github.com"
    enabled: true
  argocd:
    url: "http://argocd-server.argocd.svc.cluster.local:80/api"
    enabled: true
  gitlabCi:
    url: "https://gitlab.com/api/v4"
    enabled: false
  jenkins:
    url: "http://jenkins.neural-hive-tools.svc.cluster.local:8080"
    enabled: false
  circleci:
    url: "https://circleci.com/api/v2"
    enabled: false
  travisCi:
    url: "https://api.travis-ci.com"
    enabled: false
  # INTEGRATION Tools
  kafkaConnect:
    url: "http://kafka-connect.kafka.svc.cluster.local:8083"
    enabled: true
  airflow:
    url: "http://airflow-webserver.airflow.svc.cluster.local:8080/api/v1"
    enabled: false
  mulesoft:
    url: "https://anypoint.mulesoft.com/api"
    enabled: false
  awsEventBridge:
    url: "https://events.amazonaws.com"
    enabled: false
  azureLogicApps:
    url: "https://management.azure.com"
    enabled: false
  googleWorkflows:
    url: "https://workflowexecutions.googleapis.com"
    enabled: false

# ========================================
# Tool Credentials Configuration
# Credenciais para ferramentas que requerem autenticação
# NOTA: Em produção, usar External Secrets Operator ou Sealed Secrets
# ========================================
toolCredentials:
  # ANALYSIS Tools
  sonarqubeToken: ""
  snykToken: ""
  checkmarxApiKey: ""
  veracodeApiId: ""
  veracodeApiKey: ""
  fortifyToken: ""
  # GENERATION Tools
  githubToken: ""
  openaiApiKey: ""
  pulumiAccessToken: ""
  # VALIDATION Tools
  burpSuiteApiKey: ""
  # AUTOMATION Tools
  gitlabToken: ""
  jenkinsToken: ""
  circleciToken: ""
  travisToken: ""
  argoCdToken: ""
  # INTEGRATION Tools
  mulesoftClientId: ""
  mulesoftClientSecret: ""
  awsAccessKeyId: ""
  awsSecretAccessKey: ""
  azureClientId: ""
  azureClientSecret: ""
  azureTenantId: ""
  googleCredentialsJson: ""

serviceAccount:
  create: true
  name: mcp-tool-catalog

serviceMonitor:
  enabled: true

podDisruptionBudget:
  minAvailable: 1

networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: istio-system
        - namespaceSelector:
            matchLabels:
              name: monitoring
        - podSelector:
            matchLabels:
              neural-hive-mind.org/mcp-access: "enabled"
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: kafka
      ports:
        - protocol: TCP
          port: 9092
    - to:
        - namespaceSelector:
            matchLabels:
              name: mongodb
      ports:
        - protocol: TCP
          port: 27017
    - to:
        - namespaceSelector:
            matchLabels:
              name: redis
      ports:
        - protocol: TCP
          port: 6379
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: service-registry
      ports:
        - protocol: TCP
          port: 8080
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: analyst-agents
      ports:
        - protocol: TCP
          port: 9090
    - to:  # MCP Servers namespace
        - namespaceSelector:
            matchLabels:
              name: neural-hive-mcp
      ports:
        - protocol: TCP
          port: 3000
    - to: []  # DNS
      ports:
        - protocol: UDP
          port: 53
