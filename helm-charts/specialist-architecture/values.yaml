replicaCount: 2

autoscaling:
  enabled: false  # Desabilitado por padrão para compatibilidade com local
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

podDisruptionBudget:
  enabled: false  # Desabilitado por padrão para compatibilidade com local
  minAvailable: 1

serviceAccount:
  create: true
  name: ""
  annotations: {}

secrets:
  # Set create=false when using External Secrets Operator to prevent conflicts
  # When false, Helm will not create the Secret resource (ExternalSecret controller will manage it)
  create: true
  # IMPORTANTE: Em produção, substitua CHANGEME_PRODUCTION_PASSWORD por:
  # 1. Senha real se usando secrets inline (não recomendado)
  # 2. Referência a External Secret (recomendado): usar ExternalSecrets Operator
  # 3. Sealed Secret do Bitnami para GitOps seguro
  # Exemplo External Secret: mongodbUri será sobrescrito por external-secret-mongodb
  mongodbUri: "mongodb://root:CHANGEME_PRODUCTION_PASSWORD@mongodb.mongodb-cluster.svc.cluster.local:27017/neural_hive?authSource=admin"
  neo4jPassword: "neo4j-password-changeme"
  redisPassword: ""

image:
  repository: 077878370245.dkr.ecr.us-east-1.amazonaws.com/dev/specialist-architecture
  tag: "1.0.7"
  pullPolicy: IfNotPresent

deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

resources:
  # Production defaults - ajustar para clusters com capacidade limitada
  # Para clusters pequenos/dev, considere reduzir para:
  #   requests: cpu: 250m, memory: 512Mi
  #   limits: cpu: 1, memory: 2Gi
  # Ver environments/dev/helm-values/specialist-architecture-values.yaml para exemplo
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2
    memory: 4Gi

service:
  type: ClusterIP
  ports:
    grpc:
      port: 50051
      targetPort: 50051
      protocol: TCP
    http:
      port: 8000
      targetPort: 8000
      protocol: TCP
    metrics:
      port: 8080
      targetPort: 8080
      protocol: TCP

config:
  enableJwtAuth: false
  environment: production
  logLevel: INFO

  mlflow:
    trackingUri: "http://mlflow.mlflow.svc.cluster.local:5000"
    experimentName: "architecture-specialist"
    modelName: "architecture-evaluator"
    modelStage: "Production"

  mongodb:
    # Note: config.mongodb.uri is used for documentation/NOTES.txt display only.
    # The service uses MONGODB_URI from secrets (with authentication).
    uri: "mongodb://mongodb.mongodb-cluster.svc.cluster.local:27017"
    database: "neural_hive"
    opinionsCollection: "specialist_opinions"

  neo4j:
    uri: "bolt://neo4j-bolt.neo4j-cluster.svc.cluster.local:7687"
    user: "neo4j"
    database: "neo4j"

  redis:
    clusterNodes: "neural-hive-cache.redis-cluster.svc.cluster.local:6379"
    sslEnabled: false
    cacheTtl: 300

  otel:
    endpoint: "http://opentelemetry-collector.observability.svc.cluster.local:4317"

  grpc:
    port: 50051
    maxWorkers: 10
    maxMessageLength: 4194304

  http:
    port: 8000

  prometheus:
    port: 8080

  thresholds:
    minConfidenceScore: 0.8
    highRiskThreshold: 0.7

  timeouts:
    evaluationMs: 5000
    modelInferenceMs: 3000

  features:
    enableExplainability: true
    enableCaching: true
    enableModelMonitoring: true

  architecture:
    designPatternsEnabled: true
    solidAnalysisEnabled: true
    couplingThresholdHigh: 0.7
    cohesionThresholdLow: 0.5

serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  labels:
    prometheus: neural-hive

networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - specialist-architecture
          topologyKey: topology.kubernetes.io/zone

# Startup probe - allows up to 5 minutes for initial container startup before liveness probe takes over
# This prevents premature pod restarts during complex initialization (loading ML models, connecting to dependencies)
# TUNING GUIDE:
# - Se pods crasham com "Startup probe failed" mas logs mostram progresso normal:
#   Aumentar failureThreshold (ex: 40 para 10 minutos, 60 para 10 minutos)
# - Se model loading é lento (>3 minutos):
#   Aumentar failureThreshold ou periodSeconds
# - Para clusters rápidos com SSD:
#   Reduzir failureThreshold para 20 (3.3 minutos)
startupProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30  # 30 * 10s = 5 minutes max startup time
  successThreshold: 1

# Liveness probe - only runs after startup probe succeeds
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

# Readiness probe - only runs after startup probe succeeds
readinessProbe:
  httpGet:
    path: /ready
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

labels:
  app.kubernetes.io/name: specialist-architecture
  app.kubernetes.io/component: architecture-specialist
  app.kubernetes.io/part-of: neural-hive-mind
  neural-hive.io/component: architecture-specialist
  neural-hive.io/layer: cognitiva
  neural-hive.io/domain: architecture-analysis

annotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

# Production Secrets Management
# Para ambientes de produção, recomenda-se:
# 1. Usar External Secrets Operator com AWS Secrets Manager, Azure Key Vault, ou HashiCorp Vault
# 2. Criar ExternalSecret resource que popula o Secret specialist-architecture-secret
# 3. Nunca commitar senhas reais no Git
# Exemplo: kubectl apply -f external-secret-mongodb.yaml
