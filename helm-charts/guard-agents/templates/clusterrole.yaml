{{- if .Values.rbac.create -}}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: guard-agents
  labels:
    app: guard-agents
    neural-hive.io/component: guard-agents
rules:
# OPA Gatekeeper
- apiGroups: ["templates.gatekeeper.sh"]
  resources: ["constraints", "constrainttemplates"]
  verbs: ["get", "list", "watch", "create", "update", "delete"]
# Istio
- apiGroups: ["security.istio.io"]
  resources: ["peerauthentications", "authorizationpolicies"]
  verbs: ["get", "list", "watch", "create", "update", "delete"]
# Kubernetes Core
- apiGroups: [""]
  resources: ["pods", "pods/log", "events"]
  verbs: ["get", "list", "watch", "delete"]
# Apps
- apiGroups: ["apps"]
  resources: ["deployments", "deployments/scale"]
  verbs: ["get", "list", "watch", "update", "patch"]
# Networking
- apiGroups: ["networking.k8s.io"]
  resources: ["networkpolicies"]
  verbs: ["get", "list", "watch", "create", "update", "delete"]
# RBAC
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["rolebindings", "clusterrolebindings"]
  verbs: ["get", "list", "watch", "delete"]
{{- end }}
