component: "execution-ticket-service"
layer: "orchestration"

replicaCount: 2

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  name: ""

image:
  repository: 37.60.241.150:30500/execution-ticket-service
  tag: "1.2.0"
  pullPolicy: IfNotPresent

deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

service:
  type: ClusterIP
  annotations: {}
  ports:
    http:
      port: 8000
      targetPort: 8000
      protocol: TCP
    grpc:
      port: 50052
      targetPort: 50052
      protocol: TCP
    metrics:
      port: 9090
      targetPort: 9090
      protocol: TCP

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

podLabels:
  app.kubernetes.io/name: execution-ticket-service
  app.kubernetes.io/component: orchestration
  neural-hive.io/layer: orchestration

resources:
  requests:
    cpu: 400m      # REST + gRPC + Kafka
    memory: 768Mi
  limits:
    cpu: 1500m
    memory: 2Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

config:
  enabled: true
  serviceName: execution-ticket-service
  serviceVersion: "1.0.0"
  environment: development
  logLevel: INFO

  postgres:
    host: postgresql
    port: 5432
    database: neural_hive_tickets
    user: postgres
    sslMode: require

  mongodb:
    uri: mongodb://mongodb:27017
    database: neural_hive_orchestration

  kafka:
    bootstrapServers: kafka:9092
    consumerGroupId: execution-ticket-service
    ticketsTopic: execution.tickets
    schemaRegistryUrl: http://schema-registry.neural-hive-kafka.svc.cluster.local:8081
    securityProtocol: PLAINTEXT
    saslMechanism: SCRAM-SHA-512
    saslUsername: ""
    saslPassword: ""
    sslCaLocation: ""
    sslCertificateLocation: ""
    sslKeyLocation: ""
    schemasBasePath: /app/schemas

  jwt:
    algorithm: HS256
    expirationSeconds: 3600

  webhooks:
    enabled: true
    timeoutSeconds: 10
    maxRetries: 3

  grpc:
    port: 50052
    maxWorkers: 10

  observability:
    otelExporterEndpoint: http://otel-collector:4317
    prometheusPort: 9090

secrets:
  # Use existingSecret para referenciar secrets criados pelo create-phase2-secrets.sh
  # Os Helm charts usam secretKeyRef para ler valores diretamente dos secrets K8s
  create: false
  existingSecret: "execution-ticket-service-secrets"
  # Mapeamento de chaves do secret para vari√°veis de ambiente
  postgresPasswordKey: POSTGRES_PASSWORD
  mongodbUriKey: MONGODB_URI
  jwtSecretKeyKey: JWT_SECRET_KEY

serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s

observability:
  prometheus:
    enabled: true

istio:
  enabled: false

pdb:
  enabled: true
  minAvailable: 1

networkPolicy:
  enabled: false

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - execution-ticket-service
        topologyKey: topology.kubernetes.io/zone

tolerations: []

nodeSelector: {}

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: execution-ticket-service
