apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "analyst-agents.fullname" . }}
  labels:
    {{- include "analyst-agents.labels" . | nindent 4 }}
data:
  SERVICE_NAME: {{ .Values.config.serviceName | quote }}
  SERVICE_VERSION: {{ .Values.config.serviceVersion | quote }}

  # MongoDB
  MONGODB_URI: {{ .Values.config.mongodb.uri | quote }}
  MONGODB_DATABASE: {{ .Values.config.mongodb.database | quote }}
  MONGODB_COLLECTION_INSIGHTS: {{ .Values.config.mongodb.collectionInsights | quote }}
  MONGODB_MAX_POOL_SIZE: {{ .Values.config.mongodb.maxPoolSize | quote }}
  MONGODB_MIN_POOL_SIZE: {{ .Values.config.mongodb.minPoolSize | quote }}

  # Redis
  REDIS_HOST: {{ .Values.config.redis.host | quote }}
  REDIS_PORT: {{ .Values.config.redis.port | quote }}
  REDIS_DB: {{ .Values.config.redis.db | quote }}
  REDIS_INSIGHTS_TTL: {{ .Values.config.redis.insightsTtl | quote }}

  # Neo4j
  NEO4J_URI: {{ .Values.config.neo4j.uri | quote }}
  NEO4J_USER: {{ .Values.config.neo4j.user | quote }}
  NEO4J_PASSWORD: {{ .Values.config.neo4j.password | default "" | quote }}
  NEO4J_DATABASE: {{ .Values.config.neo4j.database | quote }}

  # ClickHouse
  CLICKHOUSE_HOST: {{ .Values.config.clickhouse.host | quote }}
  CLICKHOUSE_PORT: {{ .Values.config.clickhouse.port | quote }}
  CLICKHOUSE_USER: {{ .Values.config.clickhouse.user | quote }}
  CLICKHOUSE_DATABASE: {{ .Values.config.clickhouse.database | quote }}

  # Elasticsearch
  ELASTICSEARCH_HOSTS: '{{ .Values.config.elasticsearch.hosts | toJson }}'
  ELASTICSEARCH_USER: {{ .Values.config.elasticsearch.user | quote }}

  # Prometheus
  PROMETHEUS_URL: {{ .Values.config.prometheus.url | quote }}

  # Queen Agent
  QUEEN_AGENT_GRPC_HOST: {{ .Values.config.queenAgent.grpcHost | quote }}
  QUEEN_AGENT_GRPC_PORT: {{ .Values.config.queenAgent.grpcPort | quote }}

  # Kafka
  KAFKA_BOOTSTRAP_SERVERS: {{ .Values.config.kafka.bootstrapServers | quote }}
  KAFKA_CONSUMER_GROUP: {{ .Values.config.kafka.consumerGroup | quote }}
  KAFKA_TOPICS_TELEMETRY: {{ .Values.config.kafka.topics.telemetry | quote }}
  KAFKA_TOPICS_CONSENSUS: {{ .Values.config.kafka.topics.consensus | quote }}
  KAFKA_TOPICS_EXECUTION: {{ .Values.config.kafka.topics.execution | quote }}
  KAFKA_TOPICS_PHEROMONES: {{ .Values.config.kafka.topics.pheromones | quote }}
  KAFKA_TOPICS_INSIGHTS: {{ .Values.config.kafka.topics.insights | quote }}

  # gRPC
  GRPC_ENABLED: {{ .Values.config.grpc.enabled | quote }}
  GRPC_HOST: {{ .Values.config.grpc.host | quote }}
  GRPC_PORT: {{ .Values.config.grpc.port | quote }}

  # Observability
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.config.observability.otelEndpoint | quote }}
  PROMETHEUS_PORT: {{ .Values.config.observability.prometheusPort | quote }}
  HTTP_PORT: {{ .Values.config.observability.httpPort | quote }}
  LOG_LEVEL: {{ .Values.config.observability.logLevel | quote }}

  # Analytics
  ANALYTICS_MIN_CONFIDENCE: {{ .Values.config.analytics.minConfidence | quote }}
  ANALYTICS_WINDOW_SIZE_SECONDS: {{ .Values.config.analytics.windowSizeSeconds | quote }}

  # FastAPI
  FASTAPI_HOST: {{ .Values.config.fastapi.host | quote }}
  FASTAPI_PORT: {{ .Values.config.fastapi.port | quote }}
  CORS_ORIGINS: '{{ .Values.config.fastapi.corsOrigins | toJson }}'
