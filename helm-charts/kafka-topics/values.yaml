# Configurações do cluster Kafka
kafka:
  clusterName: "neural-hive-kafka"
  namespace: "neural-hive-kafka"

# Configurações padrão para tópicos
topicDefaults:
  partitions: 6
  replicationFactor: 3
  retentionMs: 604800000  # 7 dias em milliseconds
  compressionType: "snappy"
  cleanupPolicy: "delete"

  # Configurações para exactly-once delivery
  minInsyncReplicas: 2
  uncleanLeaderElectionEnable: false
  maxMessageBytes: 4194304  # 4MB (increased for better envelope size handling)

  # Configurações de performance
  segmentMs: 86400000      # 24 horas
  segmentBytes: 1073741824 # 1GB
  indexIntervalBytes: 4096

# Tópicos específicos por domínio conforme documento-02
topics:
  business:
    name: "intentions.business"
    description: "Intenções relacionadas a processos de negócio"
    partitions: 6
    replicationFactor: 3
    config:
      "retention.ms": "604800000"
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
      "segment.ms": "86400000"
      "segment.bytes": "1073741824"
    labels:
      "neural-hive-mind.org/domain": "business"
      "neural-hive-mind.org/intent-type": "business-process"

  technical:
    name: "intentions.technical"
    description: "Intenções relacionadas a operações técnicas"
    partitions: 8  # Maior throughput esperado para operações técnicas
    replicationFactor: 3
    config:
      "retention.ms": "604800000"
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
      "segment.ms": "86400000"
      "segment.bytes": "1073741824"
    labels:
      "neural-hive-mind.org/domain": "technical"
      "neural-hive-mind.org/intent-type": "technical-operation"

  infrastructure:
    name: "intentions.infrastructure"
    description: "Intenções relacionadas a infraestrutura e DevOps"
    partitions: 6
    replicationFactor: 3
    config:
      "retention.ms": "1209600000"  # 14 dias para auditoria
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
      "segment.ms": "86400000"
      "segment.bytes": "1073741824"
    labels:
      "neural-hive-mind.org/domain": "infrastructure"
      "neural-hive-mind.org/intent-type": "infrastructure-management"

  security:
    name: "intentions.security"
    description: "Intenções relacionadas a segurança e compliance"
    partitions: 4  # Volume menor mas crítico
    replicationFactor: 3
    config:
      "retention.ms": "2629746000"  # 30 dias para compliance
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
      "segment.ms": "86400000"
      "segment.bytes": "1073741824"
    labels:
      "neural-hive-mind.org/domain": "security"
      "neural-hive-mind.org/intent-type": "security-operation"
      "neural-hive-mind.org/compliance": "required"

  # Tópicos para sincronização de memória multicamadas
  memory-sync-events:
    name: "memory.sync.events"
    description: "Eventos de sincronização entre camadas de memória"
    partitions: 6
    replicationFactor: 3
    config:
      "retention.ms": "604800000"  # 7 dias
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
    labels:
      "neural-hive.io/type": "memory-sync"
      "neural-hive.io/layer": "conhecimento-dados"

  memory-quality-alerts:
    name: "memory.quality.alerts"
    description: "Alertas de qualidade de dados"
    partitions: 3
    replicationFactor: 3
    config:
      "retention.ms": "2629746000"  # 30 dias
      "compression.type": "lz4"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "2097152"  # 2MB
    labels:
      "neural-hive.io/type": "data-quality"
      "neural-hive.io/layer": "conhecimento-dados"

  memory-lineage-events:
    name: "memory.lineage.events"
    description: "Eventos de rastreamento de lineage de dados"
    partitions: 4
    replicationFactor: 3
    config:
      "retention.ms": "7776000000"  # 90 dias (compliance)
      "compression.type": "lz4"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "2097152"
    labels:
      "neural-hive.io/type": "lineage"
      "neural-hive.io/layer": "conhecimento-dados"
      "neural-hive.io/compliance": "required"

  # Tópicos internos para processamento
  dead-letter:
    name: "intentions.dead-letter"
    description: "Tópico para mensagens que falharam no processamento"
    partitions: 3
    replicationFactor: 3
    config:
      "retention.ms": "2629746000"  # 30 dias para troubleshooting
      "compression.type": "snappy"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"
    labels:
      "neural-hive-mind.org/type": "dead-letter-queue"
      "neural-hive-mind.org/monitoring": "critical"

  audit:
    name: "intentions.audit"
    description: "Tópico para auditoria de todas as intenções processadas"
    partitions: 4
    replicationFactor: 3
    config:
      "retention.ms": "7776000000"  # 90 dias para auditoria
      "compression.type": "lz4"      # Melhor compressão para logs
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "4194304"  # 4MB para logs detalhados
    labels:
      "neural-hive-mind.org/type": "audit-log"
      "neural-hive-mind.org/compliance": "required"
      "neural-hive-mind.org/retention": "long-term"

  autocura-events:
    name: "autocura.events"
    description: "Eventos de autocura (detecção, ação, validação) para rastreamento e auditoria conforme Fluxo E"
    partitions: 6
    replicationFactor: 3
    config:
      "retention.ms": "2592000000"  # 30 dias
      "compression.type": "lz4"
      "cleanup.policy": "delete"
      "min.insync.replicas": "2"
      "unclean.leader.election.enable": "false"
      "max.message.bytes": "2097152"  # 2MB
    labels:
      "neural-hive.io/type": "autocura"
      "neural-hive.io/compliance": "required"
      "neural-hive.io/layer": "resiliencia"

# Configurações de monitoramento
monitoring:
  enabled: true
  labels:
    "neural-hive-mind.org/monitoring": "enabled"
    "prometheus.io/scrape": "true"

# Configurações de segurança
security:
  enabled: true
  tls:
    enabled: true
  sasl:
    enabled: true
    mechanism: "SCRAM-SHA-512"

  # User definitions for ACLs
  users:
    gatewayProducer: "neural-hive-gateway-producer"  # Main producer service
    consumers:  # Optional downstream consumers
      - name: "intentions-processor"
        topics: ["intentions.business", "intentions.technical", "intentions.infrastructure"]
        consumerGroup: "intentions-processor-group"
      - name: "audit-consumer"
        topics: ["intentions.audit"]
        consumerGroup: "audit-consumer-group"

# Configurações de governança
governance:
  enabled: true
  labels:
    "neural-hive-mind.org/managed-by": "helm"
    "neural-hive-mind.org/version": "{{ .Chart.Version }}"
  annotations:
    "neural-hive-mind.org/created-by": "{{ .Values.createdBy | default \"helm\" }}"
    "neural-hive-mind.org/purpose": "event-streaming"

# Configurações por ambiente
environment: "dev"

# Configurações específicas por ambiente
environments:
  dev:
    replicationFactor: 1  # Para desenvolvimento local
    retentionMs: 86400000  # 1 dia apenas
    partitions: 3  # Menor para dev

  staging:
    replicationFactor: 2
    retentionMs: 259200000  # 3 dias
    partitions: 4

  prod:
    replicationFactor: 3
    retentionMs: 604800000  # 7 dias
    partitions: 6  # Configuração padrão

# Configurações de cleanup
cleanup:
  enabled: false  # Não remover tópicos automaticamente

# Configurações de validação
validation:
  enabled: true
  strictMode: true  # Validação rigorosa de configurações

# Configurações do Schema Registry (Apicurio)
schemaRegistry:
  url: "http://schema-registry.kafka.svc.cluster.local:8081"
  initJob:
    enabled: true
    ttlSecondsAfterFinished: 300
    backoffLimit: 3
    waitTimeout: 300
    image:
      repository: alpine
      tag: "3.19"
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
  schemas:
    - subject: "plans.ready-value"
      file: "cognitive-plan.avsc"