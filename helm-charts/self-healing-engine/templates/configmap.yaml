apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "self-healing-engine.configMapName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "self-healing-engine.labels" . | nindent 4 }}
data:
  SERVICE_NAME: {{ .Values.config.serviceName | quote }}
  NAMESPACE: {{ .Values.config.namespace | quote }}

  # Kafka Configuration
  KAFKA_BOOTSTRAP_SERVERS: {{ .Values.config.kafka.bootstrapServers | quote }}
  KAFKA_REMEDIATION_TOPIC: {{ .Values.config.kafka.remediationTopic | quote }}
  KAFKA_CONSUMER_GROUP_ID: {{ .Values.config.kafka.consumerGroupId | quote }}

  # Service Registry Configuration
  SERVICE_REGISTRY_HOST: {{ .Values.config.serviceRegistry.host | quote }}
  SERVICE_REGISTRY_PORT: {{ .Values.config.serviceRegistry.port | quote }}
  SERVICE_REGISTRY_HEARTBEAT_INTERVAL_SECONDS: {{ .Values.config.serviceRegistry.heartbeatIntervalSeconds | quote }}
  SERVICE_REGISTRY_CAPABILITIES: {{ join "," .Values.config.serviceRegistry.capabilities | quote }}

  # MongoDB Configuration
  MONGODB_URI: {{ .Values.config.mongodb.uri | quote }}
  MONGODB_DATABASE: {{ .Values.config.mongodb.database | quote }}
  MONGODB_REMEDIATION_COLLECTION: {{ .Values.config.mongodb.remediationCollection | quote }}
  MONGODB_PLAYBOOK_EXECUTIONS_COLLECTION: {{ .Values.config.mongodb.playbookExecutionsCollection | quote }}

  # Redis Configuration
  REDIS_HOST: {{ .Values.config.redis.host | quote }}
  REDIS_PORT: {{ .Values.config.redis.port | quote }}
  REDIS_DB: {{ .Values.config.redis.db | quote }}

  # Kubernetes Configuration
  KUBERNETES_IN_CLUSTER: {{ .Values.config.kubernetes.inCluster | quote }}
  KUBERNETES_NAMESPACE: {{ .Values.config.kubernetes.namespace | quote }}

  # Playbooks Configuration
  PLAYBOOKS_DIR: {{ .Values.config.playbooks.dir | quote }}
  PLAYBOOKS_TIMEOUT_SECONDS: {{ .Values.config.playbooks.timeoutSeconds | quote }}
  PLAYBOOKS_MAX_RETRIES: {{ .Values.config.playbooks.maxRetries | quote }}
  PLAYBOOKS_VALIDATION_ENABLED: {{ .Values.config.playbooks.validationEnabled | quote }}

  # Execution Configuration
  EXECUTION_MAX_CONCURRENT_EXECUTIONS: {{ .Values.config.execution.maxConcurrentExecutions | quote }}
  EXECUTION_TIMEOUT_SECONDS: {{ .Values.config.execution.executionTimeoutSeconds | quote }}
  EXECUTION_ROLLBACK_ON_FAILURE: {{ .Values.config.execution.rollbackOnFailure | quote }}

  # Observability Configuration
  OTEL_ENDPOINT: {{ .Values.config.observability.otelEndpoint | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.config.observability.otelEndpoint | quote }}
  PROMETHEUS_PORT: {{ .Values.config.observability.prometheusPort | quote }}
  HTTP_PORT: {{ .Values.config.observability.httpPort | quote }}
  GRPC_PORT: {{ .Values.config.observability.grpcPort | quote }}
  LOG_LEVEL: {{ .Values.config.observability.logLevel | quote }}

  # Execution Ticket Service Integration
  EXECUTION_TICKET_SERVICE_URL: {{ .Values.config.executionTicketService.url | quote }}
  EXECUTION_TICKET_SERVICE_TIMEOUT: {{ .Values.config.executionTicketService.timeout | quote }}
  EXECUTION_TICKET_CIRCUIT_BREAKER_THRESHOLD: {{ .Values.config.executionTicketService.circuitBreaker.threshold | quote }}
  EXECUTION_TICKET_CIRCUIT_BREAKER_RESET_SECONDS: {{ .Values.config.executionTicketService.circuitBreaker.resetSeconds | quote }}

  # Orchestrator Dynamic gRPC Integration
  ORCHESTRATOR_GRPC_HOST: {{ .Values.config.orchestrator.grpcHost | quote }}
  ORCHESTRATOR_GRPC_PORT: {{ .Values.config.orchestrator.grpcPort | quote }}
  ORCHESTRATOR_GRPC_USE_TLS: {{ .Values.config.orchestrator.useTls | quote }}
  ORCHESTRATOR_GRPC_TIMEOUT_SECONDS: {{ .Values.config.orchestrator.timeout | quote }}

  # OPA Policy Engine Integration
  OPA_HOST: {{ .Values.config.opa.host | quote }}
  OPA_PORT: {{ .Values.config.opa.port | quote }}
  OPA_ENABLED: {{ .Values.config.opa.enabled | quote }}
  OPA_FAIL_OPEN: {{ .Values.config.opa.failOpen | quote }}
  OPA_POLICY_PATH: {{ .Values.config.opa.policyPath | quote }}
