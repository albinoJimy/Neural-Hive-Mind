apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "worker-agents.fullname" . }}
  labels:
    {{- include "worker-agents.labels" . | nindent 4 }}
data:
  SERVICE_NAME: {{ .Values.config.serviceName | quote }}
  NAMESPACE: {{ .Values.config.namespace | quote }}
  CLUSTER: {{ .Values.config.cluster | quote }}
  SUPPORTED_TASK_TYPES: '{{ .Values.config.supportedTaskTypes | toJson }}'
  MAX_CONCURRENT_TASKS: {{ .Values.config.maxConcurrentTasks | quote }}

  KAFKA_BOOTSTRAP_SERVERS: {{ .Values.config.kafka.bootstrapServers | quote }}
  KAFKA_TICKETS_TOPIC: {{ .Values.config.kafka.ticketsTopic | quote }}
  KAFKA_RESULTS_TOPIC: {{ .Values.config.kafka.resultsTopic | quote }}
  KAFKA_CONSUMER_GROUP_ID: {{ .Values.config.kafka.consumerGroupId | quote }}
  KAFKA_SECURITY_PROTOCOL: {{ .Values.config.kafka.securityProtocol | quote }}
  KAFKA_SASL_MECHANISM: {{ .Values.config.kafka.saslMechanism | quote }}
  KAFKA_SASL_USERNAME: {{ .Values.config.kafka.saslUsername | quote }}
  KAFKA_SASL_PASSWORD: {{ .Values.config.kafka.saslPassword | quote }}
  KAFKA_SSL_CA_LOCATION: {{ .Values.config.kafka.sslCaLocation | quote }}
  KAFKA_SSL_CERTIFICATE_LOCATION: {{ .Values.config.kafka.sslCertificateLocation | quote }}
  KAFKA_SSL_KEY_LOCATION: {{ .Values.config.kafka.sslKeyLocation | quote }}
  KAFKA_SCHEMA_REGISTRY_URL: {{ .Values.config.kafka.schemaRegistryUrl | quote }}
  SCHEMAS_BASE_PATH: {{ .Values.config.kafka.schemasBasePath | quote }}

  SERVICE_REGISTRY_HOST: {{ .Values.config.serviceRegistry.host | quote }}
  SERVICE_REGISTRY_PORT: {{ .Values.config.serviceRegistry.port | quote }}
  HEARTBEAT_INTERVAL_SECONDS: {{ .Values.config.serviceRegistry.heartbeatIntervalSeconds | quote }}

  EXECUTION_TICKET_SERVICE_URL: {{ .Values.config.executionTicketService.url | quote }}

  ENABLE_TEMPORAL_ACTIVITIES: {{ .Values.config.temporal.enabled | quote }}
  {{- if .Values.config.temporal.enabled }}
  TEMPORAL_HOST: {{ .Values.config.temporal.host | quote }}
  TEMPORAL_PORT: {{ .Values.config.temporal.port | quote }}
  TEMPORAL_NAMESPACE: {{ .Values.config.temporal.namespace | quote }}
  TEMPORAL_TASK_QUEUE: {{ .Values.config.temporal.taskQueue | quote }}
  {{- end }}

  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.config.observability.otelEndpoint | quote }}
  PROMETHEUS_PORT: {{ .Values.config.observability.prometheusPort | quote }}
  HTTP_PORT: {{ .Values.config.observability.httpPort | quote }}
  LOG_LEVEL: {{ .Values.config.observability.logLevel | quote }}

  # Code Forge Configuration
  CODE_FORGE_URL: {{ .Values.config.codeForge.url | quote }}
  CODE_FORGE_ENABLED: {{ .Values.config.codeForge.enabled | quote }}
  CODE_FORGE_TIMEOUT_SECONDS: {{ .Values.config.codeForge.timeoutSeconds | quote }}

  # ArgoCD Configuration
  {{- if .Values.config.argocd.url }}
  ARGOCD_URL: {{ .Values.config.argocd.url | quote }}
  {{- end }}
  ARGOCD_ENABLED: {{ .Values.config.argocd.enabled | quote }}

  # OPA Configuration
  OPA_URL: {{ .Values.config.opa.url | quote }}
  OPA_ENABLED: {{ .Values.config.opa.enabled | quote }}

  # Trivy Configuration
  TRIVY_ENABLED: {{ .Values.config.trivy.enabled | quote }}
  TRIVY_TIMEOUT_SECONDS: {{ .Values.config.trivy.timeoutSeconds | quote }}

  # Test Execution Configuration
  TEST_EXECUTION_TIMEOUT_SECONDS: {{ .Values.config.testExecution.timeoutSeconds | quote }}
  ALLOWED_TEST_COMMANDS: '{{ .Values.config.testExecution.allowedCommands | toJson }}'

  # GitHub Actions
  GITHUB_ACTIONS_ENABLED: {{ .Values.config.githubActions.enabled | quote }}
  GITHUB_API_URL: {{ .Values.config.githubActions.apiUrl | quote }}

  # Validation tools
  SONARQUBE_ENABLED: {{ .Values.config.validation.sonarqube.enabled | quote }}
  SONARQUBE_URL: {{ .Values.config.validation.sonarqube.url | quote }}
  SNYK_ENABLED: {{ .Values.config.validation.snyk.enabled | quote }}
  CHECKOV_ENABLED: {{ .Values.config.validation.checkov.enabled | quote }}
