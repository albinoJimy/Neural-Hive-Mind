{{- if .Values.networkPolicy.enabled }}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: {{ include "queen-agent.fullname" . }}
  labels:
    {{- include "queen-agent.labels" . | nindent 4 }}
spec:
  podSelector:
    matchLabels:
      {{- include "queen-agent.selectorLabels" . | nindent 6 }}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  # Permitir tráfego HTTP/gRPC de outros serviços
  - from:
    - namespaceSelector:
        matchLabels:
          name: neural-hive
    ports:
    - protocol: TCP
      port: 8000
    - protocol: TCP
      port: 50053
  # Permitir scraping do Prometheus
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    ports:
    - protocol: TCP
      port: 9090
  egress:
  # Permitir DNS
  - to:
    - namespaceSelector: {}
    ports:
    - protocol: UDP
      port: 53
  # Permitir Kafka
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: kafka
    ports:
    - protocol: TCP
      port: 9092
  # Permitir MongoDB
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: mongodb
    ports:
    - protocol: TCP
      port: 27017
  # Permitir Redis
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: redis
    ports:
    - protocol: TCP
      port: 6379
  # Permitir Neo4j
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: neo4j
    ports:
    - protocol: TCP
      port: 7687
  # Permitir Prometheus
  - to:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: prometheus
    ports:
    - protocol: TCP
      port: 9090
  # Permitir Orchestrator
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: orchestrator-dynamic
    ports:
    - protocol: TCP
      port: 50051
  # Permitir Service Registry
  - to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: service-registry
    ports:
    - protocol: TCP
      port: 50051
  # Permitir Jaeger
  - to:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: jaeger
    ports:
    - protocol: TCP
      port: 4317
{{- end }}
