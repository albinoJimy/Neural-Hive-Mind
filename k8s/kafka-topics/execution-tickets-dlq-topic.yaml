apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: execution-tickets-dlq
  namespace: kafka
  labels:
    strimzi.io/cluster: neural-hive-kafka
    app.kubernetes.io/name: kafka-topic
    app.kubernetes.io/component: messaging
    neural-hive.io/layer: orchestration
    neural-hive.io/flow: fluxo-c
    neural-hive.io/dlq: "true"
spec:
  partitions: 3  # Menos partitions que topico principal (DLQ tem volume menor)
  replicas: 3
  config:
    retention.ms: 2592000000  # 30 dias (vs 7 dias do principal)
    segment.ms: 86400000  # 1 dia
    compression.type: snappy
    min.insync.replicas: 2
    cleanup.policy: delete
    max.message.bytes: 2097152  # 2MB (maior para incluir metadata de erro)
    message.timestamp.type: CreateTime
---
# Annotations para documentacao
# Este topico armazena execution tickets que falharam apos N tentativas
# Schema: ExecutionTicketDLQ (estende ExecutionTicket)
# Campos adicionais:
#   - original_error: Mensagem de erro da ultima falha
#   - retry_count: Numero de tentativas de processamento
#   - first_failure_timestamp: Timestamp da primeira falha (Unix millis)
#   - last_failure_timestamp: Timestamp da ultima falha (Unix millis)
#   - failure_reasons: Array de razoes de falha por tentativa
