# =============================================================================
# Secrets para Monitoramento de Modelos ML
# =============================================================================
#
# Este Secret armazena credenciais para alertas e notificacoes do sistema ML:
# - Slack Webhook URL para alertas em tempo real
# - SMTP Password para notificacoes por email
#
# IMPORTANTE: Este arquivo contem apenas placeholders.
# NUNCA commite credenciais reais no Git.
#
# =============================================================================
# CONFIGURACAO DO SLACK WEBHOOK
# =============================================================================
#
# 1. Acesse https://api.slack.com/messaging/webhooks
# 2. Crie um novo app ou selecione existente
# 3. Ative "Incoming Webhooks"
# 4. Adicione webhook ao canal #ml-alerts (ou outro de sua escolha)
# 5. Copie a URL gerada (formato: https://hooks.slack.com/services/XXX/YYY/ZZZ)
#
# Testar webhook manualmente:
#   curl -X POST -H 'Content-type: application/json' \
#     --data '{"text":"Teste do Neural Hive Mind ML"}' \
#     <sua-webhook-url>
#
# =============================================================================
# CONFIGURACAO DO SMTP
# =============================================================================
#
# Para Gmail com App Password:
# 1. Ative autenticacao 2FA em https://myaccount.google.com/security
# 2. Acesse https://myaccount.google.com/apppasswords
# 3. Crie uma App Password para "Mail"
# 4. Use a senha de 16 caracteres gerada (sem espacos)
#
# Para outros provedores SMTP, consulte documentacao especifica.
#
# =============================================================================
# OPCOES DE DEPLOYMENT POR AMBIENTE
# =============================================================================
#
# 1. DESENVOLVIMENTO LOCAL:
#    kubectl create secret generic model-monitor-secrets \
#      --from-literal=slack-webhook-url="https://hooks.slack.com/services/XXX/YYY/ZZZ" \
#      --from-literal=smtp-password="app-password-aqui" \
#      -n mlflow
#
# 2. PRODUCAO COM EXTERNAL SECRETS OPERATOR:
#    Veja exemplo comentado abaixo
#
# 3. GITOPS COM SEALED SECRETS:
#    a) Criar secret: kubectl create secret generic model-monitor-secrets ...
#    b) Selar: kubeseal -f secret.yaml -w sealed-secret.yaml
#    c) Commitar sealed-secret.yaml (seguro pois esta criptografado)
#
# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Verificar se o secret existe:
#   kubectl get secret model-monitor-secrets -n mlflow
#
# Verificar keys do secret:
#   kubectl get secret model-monitor-secrets -n mlflow -o jsonpath='{.data}' | jq
#
# Testar Slack webhook do pod:
#   kubectl exec -it -n mlflow <pod> -- curl -X POST \
#     -H 'Content-type: application/json' \
#     --data '{"text":"Test"}' "$SLACK_WEBHOOK_URL"
#
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: model-monitor-secrets
  namespace: mlflow
  labels:
    app: neural-hive
    component: ml-monitoring
    layer: ml-ops
  annotations:
    helm.sh/resource-policy: keep
    description: "Credenciais para alertas e notificacoes do sistema ML"
type: Opaque
stringData:
  # Slack Webhook URL para canal de alertas ML
  # Obter em: https://api.slack.com/messaging/webhooks
  slack-webhook-url: "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

  # SMTP Password para envio de emails
  # Para Gmail: usar App Password (https://myaccount.google.com/apppasswords)
  smtp-password: "your-smtp-app-password"

# =============================================================================
# EXEMPLO: External Secrets Operator com AWS Secrets Manager
# =============================================================================
#
# Pre-requisitos:
# 1. External Secrets Operator instalado
# 2. SecretStore configurado para AWS
# 3. Secrets criados no AWS Secrets Manager:
#    aws secretsmanager create-secret --name neural-hive/ml/slack-webhook \
#      --secret-string "https://hooks.slack.com/services/XXX/YYY/ZZZ"
#    aws secretsmanager create-secret --name neural-hive/ml/smtp-password \
#      --secret-string "app-password-aqui"
#
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: model-monitor-secrets-external
#   namespace: mlflow
#   labels:
#     app: neural-hive
#     component: ml-monitoring
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: SecretStore
#   target:
#     name: model-monitor-secrets
#     creationPolicy: Owner
#   data:
#   - secretKey: slack-webhook-url
#     remoteRef:
#       key: neural-hive/ml/slack-webhook
#   - secretKey: smtp-password
#     remoteRef:
#       key: neural-hive/ml/smtp-password
# =============================================================================
