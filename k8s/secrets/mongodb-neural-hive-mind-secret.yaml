# =============================================================================
# MongoDB Secret para namespace neural-hive-mind
# =============================================================================
#
# Este Secret armazena a URI de conexao ao MongoDB para o CronJob:
# - retraining-trigger-job.yaml (namespace: neural-hive-mind)
#
# IMPORTANTE: Este arquivo contem apenas placeholders.
# NUNCA commite senhas reais no Git.
#
# =============================================================================
# OPCOES DE DEPLOYMENT POR AMBIENTE
# =============================================================================
#
# 1. DESENVOLVIMENTO LOCAL:
#    kubectl create secret generic mongodb-secret \
#      --from-literal=uri="mongodb://root:dev-password@mongodb.mongodb-cluster.svc.cluster.local:27017/neural_hive?authSource=admin" \
#      -n neural-hive-mind
#
# 2. PRODUCAO COM EXTERNAL SECRETS OPERATOR:
#    Veja exemplo comentado abaixo ou k8s/external-secrets/mongodb-neural-hive-mind-secret-external.yaml
#
# 3. GITOPS COM SEALED SECRETS:
#    a) Criar secret normal: kubectl create secret generic mongodb-secret ...
#    b) Selar: kubeseal -f secret.yaml -w sealed-secret.yaml
#    c) Commitar sealed-secret.yaml no Git (seguro)
#
# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Verificar se o secret existe:
#   kubectl get secret mongodb-secret -n neural-hive-mind
#
# Decodificar URI (apenas para debug):
#   kubectl get secret mongodb-secret -n neural-hive-mind -o jsonpath='{.data.uri}' | base64 -d
#
# Verificar se CronJob consegue acessar:
#   kubectl logs -n neural-hive-mind job/<nome-do-job> | grep -i mongo
#
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: mongodb-secret
  namespace: neural-hive-mind
  labels:
    app: neural-hive
    component: ml-training
    layer: ml-ops
  annotations:
    # Evita delecao acidental durante helm upgrade/uninstall
    helm.sh/resource-policy: keep
    description: "URI de conexao MongoDB para pipelines de ML"
type: Opaque
stringData:
  # URI de conexao MongoDB
  # Formato: mongodb://usuario:senha@host:porta/database?authSource=admin
  #
  # Para Kubernetes, usar o DNS interno do servico:
  # mongodb.<namespace>.svc.cluster.local:27017
  uri: "mongodb://root:CHANGEME_PRODUCTION_PASSWORD@mongodb.mongodb-cluster.svc.cluster.local:27017/neural_hive?authSource=admin"

# =============================================================================
# EXEMPLO: External Secrets Operator com AWS Secrets Manager
# =============================================================================
#
# Pre-requisitos:
# 1. External Secrets Operator instalado no cluster
# 2. SecretStore configurado (ver k8s/external-secrets/secret-store-aws.yaml)
# 3. Secret criado no AWS Secrets Manager:
#    aws secretsmanager create-secret \
#      --name neural-hive/ml/mongodb-uri \
#      --secret-string "mongodb://user:pass@host:27017/db?authSource=admin"
#
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: mongodb-secret-external
#   namespace: neural-hive-mind
#   labels:
#     app: neural-hive
#     component: ml-training
#     layer: ml-ops
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: SecretStore
#   target:
#     name: mongodb-secret
#     creationPolicy: Owner
#   data:
#   - secretKey: uri
#     remoteRef:
#       key: neural-hive/ml/mongodb-uri
# =============================================================================
