# =============================================================================
# ExternalSecret para Model Monitor (Slack/SMTP)
# =============================================================================
#
# Este ExternalSecret sincroniza credenciais de monitoramento:
# - Slack Webhook URL para alertas
# - SMTP Password para notificacoes por email
#
# Pre-requisitos:
# - SecretStore configurado (ver secret-store-*.yaml)
# - Secrets criados no provedor externo
#
# =============================================================================

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: model-monitor-secrets-external
  namespace: mlflow
  labels:
    app: neural-hive
    component: ml-monitoring
    layer: ml-ops
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore

  target:
    name: model-monitor-secrets
    creationPolicy: Owner
    deletionPolicy: Retain

  data:
    - secretKey: slack-webhook-url
      remoteRef:
        key: neural-hive/ml/slack-webhook
    - secretKey: smtp-password
      remoteRef:
        key: neural-hive/ml/smtp-password

# =============================================================================
# COMANDOS PARA CRIAR SECRETS NO PROVEDOR
# =============================================================================
#
# AWS Secrets Manager:
#   aws secretsmanager create-secret \
#     --name neural-hive/ml/slack-webhook \
#     --secret-string "https://hooks.slack.com/services/XXX/YYY/ZZZ"
#
#   aws secretsmanager create-secret \
#     --name neural-hive/ml/smtp-password \
#     --secret-string "app-password-aqui"
#
# Azure Key Vault:
#   az keyvault secret set --vault-name neural-hive-kv \
#     --name slack-webhook --value "https://hooks.slack.com/services/XXX/YYY/ZZZ"
#
#   az keyvault secret set --vault-name neural-hive-kv \
#     --name smtp-password --value "app-password-aqui"
#
# HashiCorp Vault:
#   vault kv put secret/neural-hive/monitoring \
#     slack-webhook="https://hooks.slack.com/services/XXX/YYY/ZZZ" \
#     smtp-password="app-password-aqui"
#
# =============================================================================
# VERIFICACAO
# =============================================================================
#
# Status:
#   kubectl get externalsecret model-monitor-secrets-external -n mlflow
#
# Verificar Secret criado:
#   kubectl get secret model-monitor-secrets -n mlflow
#
# =============================================================================
