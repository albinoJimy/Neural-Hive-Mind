# =============================================================================
# SecretStore para Azure Key Vault
# =============================================================================
#
# Pre-requisitos:
#
# 1. External Secrets Operator instalado
#
# 2. Azure Key Vault criado:
#    az keyvault create --name neural-hive-kv --resource-group rg-neural-hive
#
# 3. Service Principal ou Managed Identity configurado:
#    az ad sp create-for-rbac --name external-secrets-sp
#
# 4. Permissoes no Key Vault:
#    az keyvault set-policy --name neural-hive-kv \
#      --spn <client-id> --secret-permissions get list
#
# 5. Secrets criados no Key Vault:
#    az keyvault secret set --vault-name neural-hive-kv \
#      --name mongodb-uri --value "mongodb://user:pass@host:27017/db"
#
# =============================================================================

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: azure-key-vault
  namespace: mlflow
  labels:
    app: neural-hive
    component: external-secrets
spec:
  provider:
    azurekv:
      # URL do Key Vault
      vaultUrl: "https://neural-hive-kv.vault.azure.net"
      authType: ServicePrincipal
      authSecretRef:
        # Secret contendo credenciais do Service Principal
        clientId:
          name: azure-sp-credentials
          key: client-id
        clientSecret:
          name: azure-sp-credentials
          key: client-secret
      # Tenant ID do Azure AD
      tenantId: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

---
# Secret com credenciais do Service Principal
# Criar manualmente: kubectl create secret generic azure-sp-credentials ...
# apiVersion: v1
# kind: Secret
# metadata:
#   name: azure-sp-credentials
#   namespace: mlflow
# stringData:
#   client-id: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
#   client-secret: "seu-client-secret-aqui"
