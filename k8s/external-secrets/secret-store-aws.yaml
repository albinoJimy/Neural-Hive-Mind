# =============================================================================
# SecretStore para AWS Secrets Manager
# =============================================================================
#
# Pre-requisitos:
#
# 1. External Secrets Operator instalado:
#    helm repo add external-secrets https://charts.external-secrets.io
#    helm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace
#
# 2. IAM Role para ServiceAccount (IRSA) configurado:
#    - Criar IAM Role com permissao secretsmanager:GetSecretValue
#    - Associar ao ServiceAccount do External Secrets
#
# 3. Secrets criados no AWS Secrets Manager:
#    aws secretsmanager create-secret --name neural-hive/ml/mongodb-uri \
#      --secret-string "mongodb://user:pass@host:27017/db"
#
# =============================================================================

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: mlflow
  labels:
    app: neural-hive
    component: external-secrets
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1  # Altere para sua regiao
      auth:
        # Opcao 1: IRSA (recomendado para EKS)
        jwt:
          serviceAccountRef:
            name: external-secrets-sa
        # Opcao 2: Access Key (nao recomendado para producao)
        # secretRef:
        #   accessKeyIDSecretRef:
        #     name: aws-credentials
        #     key: access-key-id
        #   secretAccessKeySecretRef:
        #     name: aws-credentials
        #     key: secret-access-key

---
# SecretStore para namespace neural-hive-mind
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: neural-hive-mind
  labels:
    app: neural-hive
    component: external-secrets
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa
