name: specialist_retraining_pipeline

conda_env: conda.yaml

entry_points:
  generate_datasets:
    parameters:
      specialist_type: {type: string, default: "technical"}
      num_samples: {type: int, default: 1000}
      output_path: {type: string, default: "/data/training/specialist_{specialist_type}_base.parquet"}
      llm_provider: {type: string, default: "local"}
      llm_model: {type: string, default: "llama2"}
      temperature: {type: float, default: 0.7}
      validate_schemas: {type: string, default: "true"}
    command: |
      python generate_training_datasets.py \
        --specialist-type {specialist_type} \
        --num-samples {num_samples} \
        --output-path {output_path} \
        --llm-provider {llm_provider} \
        --llm-model {llm_model} \
        --temperature {temperature} \
        --validate-schemas {validate_schemas}

  main:
    parameters:
      specialist_type: {type: string, default: "technical"}
      feedback_count: {type: int, default: 0}
      window_days: {type: int, default: 30}
      min_feedback_quality: {type: float, default: 0.5}
      model_type: {type: string, default: "random_forest"}
      hyperparameter_tuning: {type: string, default: "false"}
      promote_if_better: {type: string, default: "true"}
      allow_synthetic_fallback: {type: string, default: "auto"}
      real_data_days: {type: int, default: 90}
      min_real_samples: {type: int, default: 1000}
      skip_validation: {type: string, default: "false"}
    command: |
      python train_specialist_model.py \
        --specialist-type {specialist_type} \
        --feedback-count {feedback_count} \
        --window-days {window_days} \
        --min-feedback-quality {min_feedback_quality} \
        --model-type {model_type} \
        --hyperparameter-tuning {hyperparameter_tuning} \
        --promote-if-better {promote_if_better} \
        --allow-synthetic-fallback {allow_synthetic_fallback} \
        --real-data-days {real_data_days} \
        --min-real-samples {min_real_samples} \
        --skip-validation {skip_validation}

  train_all:
    parameters:
      model_type: {type: string, default: "random_forest"}
      hyperparameter_tuning: {type: string, default: "false"}
      promote_if_better: {type: string, default: "true"}
      allow_synthetic_fallback: {type: string, default: "auto"}
      real_data_days: {type: int, default: 90}
      min_real_samples: {type: int, default: 1000}
      skip_validation: {type: string, default: "false"}
    command: |
      export MODEL_TYPE={model_type} && \
      export HYPERPARAMETER_TUNING={hyperparameter_tuning} && \
      export PROMOTE_IF_BETTER={promote_if_better} && \
      export ALLOW_SYNTHETIC_FALLBACK={allow_synthetic_fallback} && \
      export REAL_DATA_DAYS={real_data_days} && \
      export MIN_REAL_SAMPLES={min_real_samples} && \
      export SKIP_VALIDATION={skip_validation} && \
      bash train_all_specialists.sh
