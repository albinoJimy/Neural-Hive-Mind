# OPA Gatekeeper Helm Values - Development Environment

# Todas as configurações devem estar aninhadas sob a chave 'gatekeeper' para o subchart
gatekeeper:
  # Development replica configuration
  replicas: 1
  auditPodCount: 1

  # Resource limits optimized for development
  controllerManager:
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

  audit:
    resources:
      limits:
        cpu: 300m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi

  # Image configuration
  image:
    repository: openpolicyagent/gatekeeper
    release: ""  # Use chart's default
    pullPolicy: IfNotPresent

  # Development-specific constraint violation enforcement
  constraintViolationsLimit: 20
  auditInterval: 60
  auditMatchKindOnly: false

  # Metrics and monitoring
  enableMetrics: true
  metricsBackends: ["prometheus"]

  # Development webhook configuration
  validatingWebhookFailurePolicy: Ignore
  validatingWebhookName: gatekeeper-validating-webhook-configuration
  validatingWebhookTimeoutSeconds: 3
  validatingWebhookCheckIgnoreFailurePolicy: Ignore
  validatingWebhookCustomRules: {}
  validatingWebhookExemptNamespacesLabels: {}

  # Mutating webhook (disabled in dev for simplicity)
  enableMutation: false
  mutatingWebhookFailurePolicy: Ignore
  mutatingWebhookReinvocationPolicy: Never
  mutatingWebhookTimeoutSeconds: 1

  # Node selection for development
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: true
    runAsGroup: 999
    runAsNonRoot: true
    runAsUser: 1000

  # Pod security context
  podSecurityContext:
    fsGroup: 999
    supplementalGroups:
    - 999

  # Development-specific exemptions
  disabledBuiltins: []

  # Enable OPA built-in functions
  enableExternalData: false
  enableGeneratorResourceExpansion: true
  enableTLSHealthcheck: false

  # Log level
  logLevel: DEBUG
  logMutations: true

  # Namespace exclusions
  exemptNamespaces: []
  exemptNamespaceLabels: []

  # Webhook namespace selector
  namespaceSelector:
    matchExpressions:
    - key: admission.gatekeeper.sh/ignore
      operator: DoesNotExist
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - kube-public
      - opa-gatekeeper
      - gatekeeper-system