# Configurações de produção para Gateway de Intenções
replicaCount: 5

image:
  repository: ghcr.io/neural-hive-mind/gateway-intencoes
  tag: "latest"

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 1000m
    memory: 2Gi

autoscaling:
  enabled: true
  minReplicas: 5
  maxReplicas: 20
  targetCPUUtilizationPercentage: 60
  targetMemoryUtilizationPercentage: 70

config:
  environment: "prod"
  logLevel: "INFO"
  debug: false

  kafka:
    bootstrapServers: "neural-hive-kafka-bootstrap.neural-hive-kafka.svc.cluster.local:9093"  # TLS
    schemaRegistryUrl: "https://schema-registry.neural-hive-kafka.svc.cluster.local:8081"

  asr:
    modelName: "medium"  # Modelo maior para melhor precisão
    device: "cpu"

  nlu:
    confidenceThreshold: 0.85  # Threshold mais alto para produção

  limits:
    maxAudioSizeMb: 15
    maxTextLength: 10000

# Ingress para produção
ingress:
  enabled: true
  className: "istio"
  hosts:
    - host: gateway.neural-hive-mind.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: gateway-intencoes-prod-tls
      hosts:
        - gateway.neural-hive-mind.com

# Security context mais restritivo
podSecurityContext:
  fsGroup: 1001
  runAsGroup: 1001
  runAsUser: 1001
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ALL]
  readOnlyRootFilesystem: false
  runAsNonRoot: true

# Network policy restritiva
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: istio-system
      ports:
        - protocol: TCP
          port: 8000
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: neural-hive-kafka
      ports:
        - protocol: TCP
          port: 9092
        - protocol: TCP
          port: 9093

# Monitoramento ativado
serviceMonitor:
  enabled: true
  interval: 15s

# PDB mais conservador
podDisruptionBudget:
  enabled: true
  minAvailable: 3

# Node selection para workloads críticos
nodeSelector:
  neural-hive-mind.org/tier: "production"
  neural-hive-mind.org/workload-type: "ml-inference"

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: neural-hive-mind.org/tier
          operator: In
          values: ["production"]