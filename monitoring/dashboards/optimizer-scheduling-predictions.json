{
  "annotations": {
    "list": [
      {
        "datasource": "Prometheus",
        "enable": true,
        "expr": "optimizer_load_bottleneck_predicted{severity=\"high\"}",
        "iconColor": "red",
        "name": "Predicted Bottlenecks",
        "step": "30s",
        "tagKeys": "task_type,horizon",
        "textFormat": "Bottleneck: {{task_type}}",
        "titleFormat": "Predicted Load Bottleneck"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "id": 1,
      "panels": [],
      "title": "Overview Stats",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 1000},
              {"color": "red", "value": 5000}
            ]
          },
          "unit": "short"
        }
      },
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 1},
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "sum(increase(optimizer_load_predictions_total{namespace=\"$namespace\"}[24h]))",
          "refId": "A"
        }
      ],
      "title": "Total Predictions (24h)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 15},
              {"color": "green", "value": 20}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 1},
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "avg(optimizer_load_forecast_accuracy_mape{namespace=\"$namespace\"} < 20) * 100",
          "refId": "A"
        }
      ],
      "title": "Forecast Accuracy (MAPE < 20%)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 100},
              {"color": "orange", "value": 500}
            ]
          },
          "unit": "short"
        }
      },
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 1},
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "sum(increase(optimizer_scheduling_optimizations_applied_total{namespace=\"$namespace\"}[24h]))",
          "refId": "A"
        }
      ],
      "title": "Optimizations Applied (24h)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "max": 1,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 0.5},
              {"color": "green", "value": 0.7}
            ]
          },
          "unit": "percentunit"
        }
      },
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 1},
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "avg(optimizer_scheduling_policy_average_reward{namespace=\"$namespace\"} > 0.7)",
          "refId": "A"
        }
      ],
      "title": "Policy Success Rate (Reward > 0.7)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 5},
      "id": 6,
      "panels": [],
      "title": "Load Forecasts",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Ticket Volume",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          },
          "unit": "reqps"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
      "id": 7,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "rate(optimizer_load_predictions_total{namespace=\"$namespace\",horizon=\"1h\"}[5m])",
          "legendFormat": "1h Horizon - {{task_type}}",
          "refId": "A"
        },
        {
          "expr": "rate(optimizer_load_predictions_total{namespace=\"$namespace\",horizon=\"6h\"}[5m])",
          "legendFormat": "6h Horizon - {{task_type}}",
          "refId": "B"
        },
        {
          "expr": "rate(optimizer_load_predictions_total{namespace=\"$namespace\",horizon=\"24h\"}[5m])",
          "legendFormat": "24h Horizon - {{task_type}}",
          "refId": "C"
        }
      ],
      "title": "Ticket Volume Forecasts by Horizon",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Resource Demand",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
      "id": 8,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "optimizer_resource_demand_forecast{namespace=\"$namespace\",resource=\"cpu\"}",
          "legendFormat": "CPU - {{task_type}}",
          "refId": "A"
        },
        {
          "expr": "optimizer_resource_demand_forecast{namespace=\"$namespace\",resource=\"memory\"}",
          "legendFormat": "Memory - {{task_type}}",
          "refId": "B"
        }
      ],
      "title": "Resource Demand Forecast by Task Type",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 14},
      "id": 9,
      "panels": [],
      "title": "Scheduling Optimization",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          },
          "unit": "short"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 0, "y": 15},
      "id": 10,
      "options": {
        "displayLabels": ["percent"],
        "legend": {"displayMode": "table", "placement": "right"},
        "pieType": "pie",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "sum by (action) (increase(optimizer_scheduling_optimizations_applied_total{namespace=\"$namespace\"}[24h]))",
          "refId": "A"
        }
      ],
      "title": "Action Distribution (24h)",
      "type": "piechart"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Reward",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "max": 1,
          "min": -1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 0.3},
              {"color": "green", "value": 0.7}
            ]
          },
          "unit": "percentunit"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 8, "y": 15},
      "id": 11,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "avg(optimizer_scheduling_policy_average_reward{namespace=\"$namespace\"})",
          "legendFormat": "Average Reward",
          "refId": "A"
        },
        {
          "expr": "quantile(0.95, optimizer_scheduling_policy_average_reward{namespace=\"$namespace\"})",
          "legendFormat": "P95 Reward",
          "refId": "B"
        }
      ],
      "title": "Policy Reward Trend",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "SLA Compliance",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 90},
              {"color": "green", "value": 95}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 16, "y": 15},
      "id": 12,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "avg(optimizer_sla_compliance_before_optimization{namespace=\"$namespace\"}) * 100",
          "legendFormat": "Before Optimization",
          "refId": "A"
        },
        {
          "expr": "avg(optimizer_sla_compliance_after_optimization{namespace=\"$namespace\"}) * 100",
          "legendFormat": "After Optimization",
          "refId": "B"
        }
      ],
      "title": "SLA Impact (Before/After)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 23},
      "id": 13,
      "panels": [],
      "title": "Model Performance",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 15},
              {"color": "orange", "value": 25},
              {"color": "red", "value": 40}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
      "id": 14,
      "options": {
        "calculate": true,
        "cellGap": 2,
        "cellValues": {},
        "color": {"exponent": 0.5, "fill": "dark-orange", "mode": "scheme", "reverse": false, "scale": "exponential", "scheme": "RdYlGn", "steps": 64},
        "exemplars": {"color": "rgba(255,0,255,0.7)"},
        "filterValues": {"le": 1e-9},
        "legend": {"show": true},
        "rowsFrame": {"layout": "auto"},
        "tooltip": {"show": true},
        "yAxis": {"axisPlacement": "left"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "optimizer_load_forecast_accuracy_mape{namespace=\"$namespace\"}",
          "format": "heatmap",
          "refId": "A"
        }
      ],
      "title": "MAPE Heatmap (by Horizon/Time-of-Day)",
      "type": "heatmap"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Duration",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "lineWidth": 0
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{"color": "green", "value": null}]
          },
          "unit": "s"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
      "id": 15,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "histogram_quantile(0.5, sum(rate(optimizer_ml_training_duration_seconds_bucket{namespace=\"$namespace\"}[5m])) by (le))",
          "legendFormat": "P50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(optimizer_ml_training_duration_seconds_bucket{namespace=\"$namespace\"}[5m])) by (le))",
          "legendFormat": "P95",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(optimizer_ml_training_duration_seconds_bucket{namespace=\"$namespace\"}[5m])) by (le))",
          "legendFormat": "P99",
          "refId": "C"
        }
      ],
      "title": "Training Duration Histogram",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 32},
      "id": 16,
      "panels": [],
      "title": "Integration Health",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Latency",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 0.5},
              {"color": "red", "value": 1}
            ]
          },
          "unit": "s"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 0, "y": 33},
      "id": 17,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "histogram_quantile(0.5, sum(rate(grpc_server_handling_seconds_bucket{namespace=\"$namespace\",grpc_service=\"OptimizerAgent\"}[5m])) by (le, grpc_method))",
          "legendFormat": "P50 - {{grpc_method}}",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(grpc_server_handling_seconds_bucket{namespace=\"$namespace\",grpc_service=\"OptimizerAgent\"}[5m])) by (le, grpc_method))",
          "legendFormat": "P95 - {{grpc_method}}",
          "refId": "B"
        }
      ],
      "title": "RPC Latency (P50/P95)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 50},
              {"color": "green", "value": 80}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 8, "y": 33},
      "id": 18,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "sum(rate(optimizer_scheduling_optimizations_applied_total{namespace=\"$namespace\",status=\"accepted\"}[5m])) / sum(rate(optimizer_scheduling_optimizations_applied_total{namespace=\"$namespace\"}[5m])) * 100",
          "refId": "A"
        }
      ],
      "title": "Recommendation Acceptance Rate",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisLabel": "Hit Rate",
            "axisPlacement": "auto",
            "fillOpacity": 10,
            "lineInterpolation": "smooth",
            "lineWidth": 2
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 50},
              {"color": "green", "value": 80}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 8, "x": 16, "y": 33},
      "id": 19,
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "sum(rate(optimizer_cache_hits_total{namespace=\"$namespace\",cache_type=\"model\"}[5m])) / sum(rate(optimizer_cache_requests_total{namespace=\"$namespace\",cache_type=\"model\"}[5m])) * 100",
          "legendFormat": "Model Cache",
          "refId": "A"
        },
        {
          "expr": "sum(rate(optimizer_cache_hits_total{namespace=\"$namespace\",cache_type=\"forecast\"}[5m])) / sum(rate(optimizer_cache_requests_total{namespace=\"$namespace\",cache_type=\"forecast\"}[5m])) * 100",
          "legendFormat": "Forecast Cache",
          "refId": "B"
        }
      ],
      "title": "Cache Hit Rates",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 41},
      "id": 20,
      "panels": [],
      "title": "Bottleneck Detection",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 60},
              {"color": "orange", "value": 80},
              {"color": "red", "value": 95}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 42},
      "id": 21,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "optimizer_resource_saturation_forecast{namespace=\"$namespace\",horizon=\"1h\"}",
          "legendFormat": "1h Forecast - {{resource}}",
          "refId": "A"
        }
      ],
      "title": "Resource Saturation Forecast (1h)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 60},
              {"color": "orange", "value": 80},
              {"color": "red", "value": 95}
            ]
          },
          "unit": "percent"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 42},
      "id": 22,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        }
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "optimizer_resource_saturation_forecast{namespace=\"$namespace\",horizon=\"6h\"}",
          "legendFormat": "6h Forecast - {{resource}}",
          "refId": "A"
        }
      ],
      "title": "Resource Saturation Forecast (6h)",
      "type": "stat"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["optimizer", "ml", "scheduling", "predictions"],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "default",
          "value": "default"
        },
        "hide": 0,
        "includeAll": false,
        "label": "Namespace",
        "multi": false,
        "name": "namespace",
        "options": [],
        "query": "label_values(optimizer_load_predictions_total, namespace)",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "auto": true,
        "auto_count": 30,
        "auto_min": "10s",
        "current": {
          "selected": false,
          "text": "auto",
          "value": "$__auto_interval_time_range"
        },
        "hide": 0,
        "label": "Time Range",
        "name": "time_range",
        "options": [
          {"selected": true, "text": "auto", "value": "$__auto_interval_time_range"},
          {"selected": false, "text": "1m", "value": "1m"},
          {"selected": false, "text": "10m", "value": "10m"},
          {"selected": false, "text": "30m", "value": "30m"},
          {"selected": false, "text": "1h", "value": "1h"},
          {"selected": false, "text": "6h", "value": "6h"},
          {"selected": false, "text": "12h", "value": "12h"},
          {"selected": false, "text": "1d", "value": "1d"}
        ],
        "query": "1m,10m,30m,1h,6h,12h,1d",
        "refresh": 2,
        "skipUrlSync": false,
        "type": "interval"
      }
    ]
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Optimizer ML Scheduling Predictions",
  "uid": "optimizer-scheduling-predictions",
  "version": 1,
  "weekStart": ""
}
